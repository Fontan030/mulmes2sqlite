# mulmes2sqlite

**Merge chats from multiple messengers into a single SQLite database ⛁**

Currently supported messaging services:
* VK (ВКонтакте) via HTML data export
* Telegram via JSON data export

(not that much, but more services will be added in future releases)

## Installation and usage

1. Make sure you have Python 3.8 or higher installed
2. Clone this repository:
```bash
git clone https://github.com/Fontan030/mulmes2sqlite.git
cd mulmes2sqlite
```
3. Set up the Python virtual environment and install dependencies:
```bash
pip install -r requirements.txt
```
4. Import your messages into a database:
```bash
python mulmes2sqlite.py -p [parser] -i input_dir/ out.db
```
If the file `out.db` doesn't exist, it will be created automatically. You can import chats from different messaging services into the same DB file, which is the key point of this application. This may be useful if you want to somehow analyze your personal data scattered across multiple platforms or just have a compact backup of all your messages (as SQLite is more convenient and space efficient format than, for example, [HTML with obsolete CP-1251 encoding](https://timmarinin.net/2021/vk-data-export/))

5. Browse the database using an external application such as [DB Browser for SQLite](https://sqlitebrowser.org/dl/)

## Data import instructions

### VK data import (HTML)

1. Request your data archive from the [official VK website](https://vk.com/data_protection?section=rules&scroll_to_archive=1)
2. Download ZIP archive with HTML files and unpack it into the `input_dir` directory
3. Create a database file `out.db` with your data:
```bash
python mulmes2sqlite.py -p vkhtml -i input_dir/ output/out.db
```
4. If `input_dir` contains valid HTML files, mulmes2sqlite will show the list of chats found:
```bash
VKhtmlParser backend: html.parser, process count: 2
Your ID and username: 206488478, Вы
Found 349 chats:
[1] Стикеры ВКонтакте
[2] Бот Максим
...
Type 'a' to import all chats (default), 's' to select the desired chats, 'q' to quit
> 
```

#### Performance tips

ZIP archives generated by VK usually contain more than 1000 HTML files (with up to 50 messages in each file). Processing them may take a while, so you can use the lxml parser to speed up HTML processing:
```bash
pip install lxml # if not installed
python mulmes2sqlite.py -p vkhtml --bs4-backend lxml -i input_dir/ output/out.db
```
By default, the parser uses half of available CPU cores (for example, 2 of 4). You can specify the number of CPU cores with the `-j` option:
```bash
python mulmes2sqlite.py -p vkhtml --bs4-backend lxml -j 4 -i input_dir/ output/out.db
```
However, if your Python enviroment doesn't support [multiprocessing](https://docs.python.org/3/library/multiprocessing.html), the parser runs in single process mode, ignoring the `-j` option.
On Windows the multiprocessing module may work [significantly slower than expected](https://stackoverflow.com/questions/52465237/multiprocessing-slower-than-serial-processing-in-windows-but-not-in-linux), so you can force the parser to run in single process mode by entering `-j 1`.

### Telegram data import (JSON)

1. Download [Telegram Desktop](https://desktop.telegram.org/)
2. Open `Settings -> Advanced -> Export Telegram data` and export your messages to `Machine-readable JSON` format. You can also export messages from a single chat via the three-dot menu.
3. Replace `input_dir` here with the path to Telegram export directory (usually `~/Downloads/Telegram\ Desktop/`) and run the script:
```bash
python mulmes2sqlite.py -p tgjson -i input_dir/ output/out.db
```
4. You can see the list of found chats and choose what to import:
```bash
Found 50 chats:
[1] Full data export (41 chats)
[2] Василий
...
Type 'a' to import all chats (default), 's' to select the desired chats, 'q' to quit
> 
```
Note: at the moment it's impossible to select specific chats inside a `result.json` file generated by Full data export

## TODO list

* General:
    * add WhatsApp support (via `msgstore.db` file)
    * create GUI version of the application
    * implement some basic database viewer for the GUI version
* Telegram:
    * add support for HTML files created by Telegram Desktop
* VK:
    * VKhtmlParser: read data directly from ZIP archive (without unpacking it) ✅
    * VKhtmlParser: add support for more locales (cause the parser currently relies on hard-coded Russian strings; same problem mentioned [here](https://github.com/povle/emotional-rollercoaster/blob/main/README.md#%D0%B2%D1%8B%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0-%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D0%B9) )
    * find another data sources? (because the official HTML export doesn't preserve forwarded messages at all)

## Similar projects

This list is obviosly not complete and includes some useful projects with similar goals:
* VK HTML parsing
    * https://github.com/remixer-dec/vk-export-msg-searcher
    * https://github.com/DvaMishkiLapa/VKArchiveDownloader
    * https://github.com/kiraind/vk-msg-stats
    * https://github.com/povle/emotional-rollercoaster
* Telegram JSON parsing
    * https://github.com/keizerzilla/telegram-chat-parser
* WhatsApp `msgstore.db` processing
    * https://github.com/absadiki/whatsapp-msgstore-viewer
* Data import from multiple platforms
    * https://github.com/frozenspider/chat-history-manager